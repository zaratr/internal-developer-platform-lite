# Platform Standards

These standards apply to all services generated by IDP-Lite.

## Service shape
- FastAPI application with ASGI entrypoint at `app.main:app`.
- `/health/live` and `/health/ready` endpoints exist and respond with JSON.
- Structured JSON logging using `platform.app.logging.configure_logging`.
- Correlation ID middleware sets/propagates `X-Request-ID`.
- Config loaded exclusively through `ConfigProvider` implementation.

## Configuration & secrets
- Secrets must not be read directly via `os.environ` in service code.
- Local development uses `.env` and YAML overlays (`config/<env>.yaml`).
- Provider interface is designed to be swapped with Vault or cloud KMS.

## Pipelines
- Lint (`ruff`) and test (`pytest`) gates are mandatory.
- Security scanning via `pip-audit` is required before builds.
- Images are tagged with the git SHA and environment-specific aliases (`latest-dev`, `latest-staging`, `latest-prod`).
- Promotion requires previous environment success; prod cannot deploy if staging failed.

## Operational expectations
- Logs are JSON and include timestamp, level, service name, and correlation ID.
- Readiness endpoint must fail if required dependencies/config are missing.
- Rollback can redeploy the previous successful image tag.
- Docker images must use non-root users where possible (template uses `nonroot` user).

## Testing expectations
- Template generation has unit coverage.
- Config provider behavior is unit-tested.
- A smoke test ensures generated services boot and expose health endpoints.
